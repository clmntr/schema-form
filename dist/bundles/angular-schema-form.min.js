/*!
 * angular-schema-form
 * @version 0.0.1
 * @date Thu, 18 Apr 2019 08:29:02 GMT
 * @link https://github.com/json-schema-form/angular-schema-form
 * @license MIT
 * Copyright (c) 2014-2019 JSON Schema Form
 */!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t){e.exports=angular},function(e,t){e.exports=tv4},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(1),o=r.n(a);function s(e){e.addValidator("tv4",{validate:function(e,t){""===t&&(t=void 0),-1===e.schema.type.indexOf("null")&&null===t&&(t=void 0);var r={type:"object",properties:{}},n=e.finalKey;r.properties[n]=e.schema,e.form.required&&(r.required=[n]);var a={};return i.a.isDefined(t)&&(a[n]=t),o.a.validateResult(a,r)}})}i.a.module("schemaForm").config(s),s.$inject=["sfValidatorsProvider"]},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n);function a(e,t){var r=this;function n(e){return e.replace(/\'/g,"\\'").replace(/\"/g,'\\"')}function a(n,o,s,l,c){c=c||{},r.state=c,l=l||"schemaForm.form";var u=document.createDocumentFragment();return n.reduce(function(r,n,u){if(!n.templateType)return r;var f=o[n.templateType]||o.default,m=t.getFragment(n.template||f.template);if(m){var d=n.builder||f.builder,p={fieldFrag:m,node:n,state:c,path:l+"["+u+"]",build:function(e,t,r){return a(e,o,s,t,r)}};"function"==typeof d&&(d=[d]),i.a.forEach(d,function(e,t){e(p)}),(function(t,r){if(t.arrayKey){var n=r[e.stringify(t.arrayKey)];if(n){for(;n.firstChild;)n.removeChild(n.firstChild);return n}}}(n,s)||r).appendChild(m)}return r},u),u}function o(e,t,n){var o=this;return o.builders=r.builders,o.stdBuilders=r.stdBuilders,o.build=function(e,t,r,o){return t=t||n.decorator(),i.a.isArray(e)||(e=[e]),a(e,t,r,o,void 0)},o.render=function(e,r,n,i,a,s){a[0].appendChild(o.build(e,r,n,i)),t(a.children())(s)},o}r.builders={sfNode:function(e){e.fieldFrag.firstChild.setAttribute("sf-node",e.node.id)},simpleTransclusion:function(e){var t=e.build(e.node.items,e.path+".items",e.state);e.fieldFrag.firstChild.appendChild(t)},ngModelOptions:function(e){e.node.form&&e.node.form.ngModelOptions&&Object.keys(e.node.form.ngModelOptions).length>0&&e.fieldFrag.firstChild.setAttribute("ng-model-options",JSON.stringify(e.node.form.ngModelOptions))},transclusion:function(e){var t=e.fieldFrag.querySelectorAll("[sf-field-transclude]");if(t.length)for(var r=0;r<t.length;r++){var n=t[r],i=n.getAttribute("sf-field-transclude")||"items",a=e.node.form[i];if(a){var o=e.build(a,e.path+"."+i,e.state);n.appendChild(o)}}},condition:function(t){if(t.node.condition){var r="evalExpr('"+n(t.node.condition)+'\', { model: model, "arrayIndex": $index})';if(t.node.arrayKey){var i=e.stringify(t.node.arrayKey);r="evalExpr('"+n(t.node.condition)+'\', { model: model, "arrayIndex": $index, "modelValue": model'+("["===i[0]?"":".")+i+"})"}for(var a=t.fieldFrag.children||t.fieldFrag.childNodes,o=0;o<a.length;o++){var s=a[o],l=s.getAttribute("ng-if");s.setAttribute("ng-if",l?"("+l+") || ("+r+")":r)}}}},r.stdBuilders=[r.builders.sfNode,r.builders.ngModelOptions,r.builders.condition],o.$inject=["$templateCache","$compile","sfDecorators"],r.$get=o}a.$inject=["sfPathProvider","sfTemplateProvider"];var o=a;function s(e,t,r,n){var a="",o={};this.defineDecorator=function(e,t){o[e]={__name:e},i.a.forEach(t,function(t,a){t.builder=t.builder||r.stdBuilders,t.replace=!i.a.isDefined(t.replace)||t.replace,t.template=n.addTemplateUrl(t.template),"default"===a&&n.setDefault(t.template),o[e][a]=t}),o[a]||(a=e)},this.decorator=function(e){return o[e=e||a]},this.defineAddOn=function(e,t,r,i){if(o[e]){var a=n.addTemplateUrl(r);o[e][t]={template:a,builder:i,replace:!0},"default"===t&&n.setDefault(a)}},this.$get=function(){return{decorator:function(e){return o[e]||o[a]},defaultDecorator:a}}}s.$inject=["$compileProvider","sfPathProvider","sfBuilderProvider","sfTemplateProvider"];var l=s;function c(){var e={default:"Field does not validate",0:"Invalid type, expected {{schema.type}}",1:"No enum match for: {{viewValue}}",10:'Data does not match any schemas from "anyOf"',11:'Data does not match any schemas from "oneOf"',12:'Data is valid against more than one schema from "oneOf"',13:'Data matches schema from "not"',100:"Value is not a multiple of {{schema.multipleOf}}",101:"{{viewValue}} is less than the allowed minimum of {{schema.minimum}}",102:"{{viewValue}} is equal to the exclusive minimum {{schema.minimum}}",103:"{{viewValue}} is greater than the allowed maximum of {{schema.maximum}}",104:"{{viewValue}} is equal to the exclusive maximum {{schema.maximum}}",105:"Value is not a valid number",200:"String is too short ({{viewValue.length}} chars), minimum {{schema.minLength}}",201:"String is too long ({{viewValue.length}} chars), maximum {{schema.maxLength}}",202:"String does not match pattern: {{schema.pattern}}",300:"Too few properties defined, minimum {{schema.minProperties}}",301:"Too many properties defined, maximum {{schema.maxProperties}}",302:"Required",303:"Additional properties not allowed",304:"Dependency failed - key must exist",400:"Array is too short ({{value.length}}), minimum {{schema.minItems}}",401:"Array is too long ({{value.length}}), maximum {{schema.maxItems}}",402:"Array items are not unique",403:"Additional items not allowed",500:"Format validation failed",501:'Keyword failed: "{{title}}"',600:"Circular $refs",1000:"Unknown property (not in schema)"};e.number=e[105],e.required=e[302],e.min=e[101],e.max=e[103],e.maxlength=e[201],e.minlength=e[200],e.pattern=e[202],this.setDefaultMessages=function(t){e=t},this.getDefaultMessages=function(){return e},this.setDefaultMessage=function(t,r){e[t]=r},this.$get=["$interpolate",function(t){var r={};return r.defaultMessages=e,r.interpolate=function(r,n,a,o,s,l){s=s||{};var c=o.form||{},u=c.validationMessage||{};0===r.indexOf("validator-")&&(r=r.substring(10));var f=u.default||s.default||"";[u,s,e].some(function(e){return i.a.isString(e)||i.a.isFunction(e)?(f=e,!0):e&&e[r]?(f=e[r],!0):void 0});var m={config:l,error:r,value:n,viewValue:a,form:c,schema:o.schema,title:c.title||o.schema&&o.schema.title};return i.a.isFunction(f)?f(m):t(f)(m)},r}]}c.$inject=[];var u=c;function f(e,t,r){var n=this;function a(){return this.compile=n.compile,this}function o(e,t,r,n){var a=[];return i.a.forEach(e,function(e,i){n&&(e=t.key+"[]."+e.key),a.push(new c(e,t,r,i))}),a}function s(e,t,r,n){var a={};return i.a.forEach(e,function(e,i){n&&(e=t.key+"."+i),a[i]=new c(e,t,r,i)}),a}function l(e,t){if(n.handlers[e])return n.handlers[e].reduce(function(e,r){return e||r(t)},!1)}function c(r,n,a,u){var f=this;return f.set=function(t){if(f.schema)return e.select(f.arrayKey,f.model,t)},f.get=function(){if(f.schema)return e.select(f.arrayKey,f.model)},f.getSet=function(e){return f.set(e)},f.itemFactory=function(t){var r={key:f.key+"[]",filledKey:f.key+"["+t+"]"};return i.a.isObject(f.schema.items)&&i.a.isArray(f.form.items)?r.properties=f.form.items.reduce(function(t,n){var a=e.parse(n.key).slice(-1)[0],o=i.a.merge({filledKey:r.filledKey+"."+a},n);return t[a]=o,t},{}):i.a.isArray(f.schema.items)&&i.a.isArray(f.form.items)&&(r.items=f.form.items),new c(r,f,a,t)},function(){if(f.id=n.id?String(n.id)+"."+String(u):String(u),f.type="section",f.model=a.model,f.options=a.options,i.a.isString(r)&&(r={key:r}),r.key){f.key=r.filledKey||r.key,f.arrayKey=e.parse(f.key),f.finalKey=f.arrayKey[f.arrayKey.length-1];var c=function e(t,r){if(1===t.length)return{parent:r,property:r.properties&&r.properties[t[0]]||{}};var n=t[0];if(""===n)return e(t.slice(1),r);var a=r.properties[n]||{},o=t.slice(1);return 1===o.length&&i.a.isObject(a.items)?{parent:a,property:a.items}:a.items?e(o,a.items):a.properties?e(o,a):{}}(e.parse(r.key),a.schema);if(f.schema=(d=f.finalKey,p=c.property,h=c.parent,v=a.schema,g=i.a.merge({},p),y=h.required&&-1!==h.required.indexOf(d),g["x-schema-form"]=i.a.merge({},v["x-schema-form"],p["x-schema-form"]),g.required||(g["x-schema-form"].required=y),!0===v.readonly&&(g["x-schema-form"].readonly=!0),g),!f.schema.type)return console.error("Schema not found for the form key : "+f.key),{};if(!r.type)if(i.a.isArray(f.schema.type)){for(var m in f.schema.type)if(f.templateType=l(f.schema.type[m],f.schema),f.templateType){f.type=f.schema.type[m];break}}else f.templateType=l(f.schema.type,f.schema);"section"==f.type&&f.schema.type&&(f.type=f.schema.type)}var d,p,h,v,g,y;if(r){var $=f.schema,x=i.a.merge({},f.options&&f.options.formDefaults);n.form&&(x.readonly=n.form.readonly),$&&($.title&&(x.title=$.title),$.description&&(x.description=$.description),$.required&&(x.required=$.required),$.readonly&&(x.readonly=$.readonly),($.maxlength||$.maxLength)&&(x.maxlength=$.maxlength||$.maxLength),($.minlength||$.minLength)&&(x.minlength=$.minlength||$.minLength),$.minimum&&(x.minimum=$.minimum+($.exclusiveMinimum?1:0)),$.maximum&&(x.maximum=$.maximum-($.exclusiveMaximum?1:0)),$.validationMessage&&(x.validationMessage=$.validationMessage),!$.enum||r.titleMap||$["x-schema-form"].titleMap||(x.titleMap=$.enum.map(function(e){return{value:e,name:e}}))),f.form=i.a.merge(x,$?$["x-schema-form"]:{},r)}return f.templateType||(f.templateType=f.form.type||"default"),f.form.template?f.template=t.addTemplateString(f.form.template):f.form.templateUrl&&(f.template=t.addTemplateUrl(f.form.templateUrl)),f.form.decorator&&(f.decorator=f.form.decorator),f.form.builder&&(f.builder=f.form.builder),f.form.condition&&(f.condition=f.form.condition),f.items=[],f.properties={},i.a.isArray(f.form.items)&&"array"!==f.type?f.items=o(f.form.items,f,a):i.a.isObject(f.form.properties)?f.properties=s(f.form.properties,f,a):f.schema&&f.schema.items&&!i.a.isObject(f.schema.items)?f.items=o(f.schema.items,f,a,!0):f.schema&&i.a.isObject(f.schema.properties)&&(f.properties=s(f.schema.properties,f,a,!0)),f}()}n.handlers={string:[function(e){return-1!==e.type.indexOf("string")&&e.enum&&"select"},function(e){return-1!==e.type.indexOf("string")&&!e.enum&&"text"}],object:[function(e){return-1!==e.type.indexOf("object")&&"fieldset"}],number:[function(e){return-1!==e.type.indexOf("number")&&"number"}],integer:[function(e){return-1!==e.type.indexOf("integer")&&"number"}],boolean:[function(e){return-1!==e.type.indexOf("boolean")&&"checkbox"}],array:[function(e){return-1!==e.type.indexOf("array")&&e.items&&e.items.enum&&"checkboxes"},function(e){return-1!==e.type.indexOf("array")&&"array"}]},n.compile=function(e,t,n,i,a){e=e||["*"],r.compile(t);var s=e.indexOf("*");return s>=0&&t.properties&&Array.prototype.splice.apply(e,[s,1].concat(Object.keys(t.properties))),o(e,{},{schema:t,model:n,options:i,ignored:a})},a.$inject=[],n.$get=a}f.$inject=["sfPathProvider","sfTemplateProvider","sfSchemaProvider"];var m=f;function d(){var e=this,t=window.ObjectPath;e.parse=t.parse,e.stringify=t.stringify,e.normalize=function(t,r){return e.stringify(Array.isArray(t)?t:e.parse(t),r)},e.hash=function(e){var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},e.getModelAccessor=function(t,r){if(t){var n=e.stringify(t).replace(/"/g,"&quot;"),i=r||"model";return n&&(i+=("["!==n[0]?".":"")+n),i}return null},e.select=function(t,r,n,i){r||(r=this);var a="string"==typeof t?e.parse(t):t,o=void 0!==n||!0===i;if(o&&1===a.length)return r[a[0]]=n,r;o&&void 0===r[a[0]]&&(r[a[0]]=a.length>2&&/^\d+$/.test(a[1])?[]:{});for(var s=r[a[0]],l=1;l<a.length;l++){if(""===a[l])return;if(o){if(l===a.length-1)return s[a[l]]=n,n;var c=s[a[l]];null==c&&(c=/^\d+$/.test(a[l+1])?[]:{},s[a[l]]=c),s=c}else s&&(s=s[a[l]])}return s},e.$get=function(){return{parse:e.parse,stringify:e.stringify,normalize:e.normalize,hash:e.hash,getModelAccessor:e.getModelAccessor,select:e.select}}}d.$inject=[];var p=d;function h(e,t){var r=this;r.validate=function(t,r){return t&&t.schema?e.validate(t,r):{valid:!0}},r.compile=function(e,n){r.traverseSchema(e,function(r,n){if(i.a.isDefined(r.$ref)){var a=r.$ref.replace(/#\//g,"").replace(/\//g,"."),o=t.select(a,e);i.a.merge(r,o)}})},r.setDefaults=function(e,n,a,o){r.traverseSchema(e,function(e,r){if(i.a.isDefined(e.default)){var a=t.select(r,n);i.a.isUndefined(a)&&t.select(r,n,e.default)}},a,o)},r.traverseSchema=function(e,t,r,i){n(e,t,r||[],Boolean(i))};var n=function(e,t,r,a){t(e,r),i.a.forEach(e.properties,function(e,i){var o=r.slice();o.push(i),n(e,t,o,a)}),!a&&e.items&&n(e.items,t,r.slice(),a)};function a(){return this.validate=r.validate,this.setDefaults=r.setDefaults,this.traverseSchema=r.traverseSchema,this}a.$inject=[],r.$get=a}h.$inject=["sfValidatorsProvider","sfPathProvider"];var v=h;function g(e){var t=this,r={},n=void 0;function a(e,r){return t.fragments[e]=function(e){var t=document.createDocumentFragment(),r=document.createElement("div");for(r.innerHTML=e;r.childNodes.length>0;)t.appendChild(r.childNodes[0]);return t}(r),e}function o(e,n,i){return this.getFragment=t.getFragment,this.addTemplateString=t.addTemplateString,this.addTemplateUrl=t.addTemplateUrl,this.load=function(){return e.all(Object.entries(r).map(function(r){if(!t.fragments[r[1]]){var o=i.get(r[0]);return o?a(r[1],o):n.get(r[0],{cache:i}).then(function(e){return a(r[1],e)})}return e.when(r[1])})).then(function(e){r={}})},this}t.fragments={},t.setDefault=function(t){return n=i.a.isString(t)?e.hash(t):t},t.getFragment=function(r){return i.a.isString(r)&&(r=e.hash(r)),(t.fragments[r]||t.fragments[n]||document.createDocumentFragment()).cloneNode(!0)},t.addTemplateString=function(r){var n=e.hash(r);return t.fragments[n]||a(n,r),n},t.addTemplateUrl=function(n){if(!r[n]){var i=e.hash(n);return t.fragments[i]||(r[n]=i),i}return r[n]},o.$inject=["$q","$http","$templateCache"],t.$get=o}g.$inject=["sfPathProvider"];var y=g;function $(){var e=this,t={};function r(e,t,r,n){if(e){var a=e.validate(r,n);(t.valid||!t.valid&&!a.valid)&&i.a.merge(t,a)}}function n(t){return this.validate=e.validate,this}e.addValidator=function(e,r){i.a.isFunction(r)&&(r={validate:r}),t[e]=r},e.removeValidator=function(e){t[e]=void 0},e.validate=function(e,n){var a={valid:!0};return e.schema&&e.schema.validators?i.a.forEach(e.schema.validators,function(i){r(t[i],a,e,n)}):i.a.forEach(t,function(t){r(t,a,e,n)}),a},n.$inject=[],e.$get=n}$.$inject=[];var x=$;function b(e,t){var r=e.has("$sanitize")?e.get("$sanitize"):function(e){return e};return{scope:!1,restrict:"EA",link:function(e,n,a){var o,s="";a.sfMessage&&e.$watch(a.sfMessage,function(t){t&&(s=r(t),c(!!e.ngModel))});var l=function(e){e!==o&&(n.html(e),o=e)},c=function(r){if(r)if(e.hasError()){var n=[];i.a.forEach(e.ngModel&&e.ngModel.$error,function(e,t){e&&n.push(t)}),n=(n=n.filter(function(e){return"schemaForm"!==e})).filter(function(e){return"parse"!==e});for(var a=i.a.isArray(e.form.validationPriority)&&e.form.validationPriority.length||0;a--;){var o=n.indexOf(e.form.validationPriority[a]);-1!=o&&n.splice(0,0,n.splice(o,1)[0])}var c=n[0];l(c?t.interpolate(c,e.ngModel.$modelValue,e.ngModel.$viewValue,e,e.options&&e.options.validationMessage,e.evalExpr("config")):s)}else l(s);else l(s)};c();var u=e.$watch("ngModel",function(e){e&&(e.$parsers.push(function(e){return c(!0),e}),e.$formatters.push(function(e){return c(!0),e}),u())});e.$watchCollection("ngModel.$error",function(){c(!!e.ngModel)})}}}b.$inject=["$injector","sfErrorMessage"];var M=b;function O(e,t,r,n,a,o){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"^sfSchema",link:{pre:function(e,t,r,s){var l=r.node||r.sfNode,c=void 0;try{c=e.$eval(l)}catch(e){}i.a.isObject(c)||(c=s.lookup(l)),i.a.extend(e,c),e.node=e,i.a.isString(e.key)&&(e.changeCallbacks=[],e.form&&e.form.onChange&&function(e){e.changeCallbacks.push(function(e,t,r){i.a.isFunction(r.form.onChange)?r.form.onChange(e,r.form):r.evalExpr(r.form.onChange,{modelValue:e,form:r.form,model:e})})}(e),"array"===e.type?function(e){function t(t){i.a.isArray(e.get())||e.set([]);var r=t-e.get().length,n=void 0;if(0!==r){n=r>0?e.addItem:e.removeItem;var a=r;for(r=Math.abs(r);r--;)n.call(e,e.get().length-1);return a}}function r(r){r=r||e.schema.length,i.a.isString(r)&&(r=n.select(n.parse(r),e.model)),i.a.isNumber(r)&&t(r)}e.addItem=function(t){if(e.itemFactory){var r=e.items.length,n=e.itemFactory(r);if(e.items.push(n),!0!==t){var i=e.get();i?i.push({}):e.set([{}]),e.options&&!1===e.options.setSchemaDefaults||a.setDefaults(e.schema,e.model,n.arrayKey)}return r}return-1},e.removeItem=function(t){if(e.items.length>t){e.items.splice(-1,1);var r=e.get();return r.splice(t,1),(t||1)-1}return e.items.length-1},e.changeCallbacks.push(function(e,t,n){var i=r();i||(n.ngModel&&n.validateExternal?n.validateExternal():o.validate(n,e))});for(var s=e.get()&&e.get().length||0,l=0;l<s;l++)e.addItem(!0);if(e.schema.length)if(i.a.isString(e.schema.length)){var c=n.parse(e.schema.length);e.$watch(function(){return n.select(c,e.model)},function(e,t){i.a.isNumber(e)&&r(e)})}else r();else if(!0!==e.schema.startEmpty){var u=e.schema.minItems||0;s<u&&t(e.schema.minItems||0)}}(e):"object"===e.type&&function(e){e.changeCallbacks.push(function(e,t,r){o.validate(r,e)})}(e),e.value=e.get(),e.$watch(function(){return e.$eval(n.getModelAccessor(e.arrayKey),{model:e.model})},function(e,t,r){e!==r.value&&(r.value=e)},!0),e.$watch("value",function(e,t,r){e!==t&&(n.select(r.arrayKey,r.model,e,!0),r.$emit("schemaForm.valueChanged."+r.arrayKey.join("."),e),i.a.forEach(r.changeCallbacks,function(n){n.call(r,e,t,r)}))},!0))},post:function(t,r,a,o){t.showTitle=function(){return t.form&&!0!==t.form.notitle&&t.form.title},t.listToCheckboxValues=function(e){var t={};return i.a.forEach(e,function(e){t[e]=!0}),t},t.checkboxValuesToList=function(e){var t=[];return i.a.forEach(e,function(e,r){e&&t.push(r)}),t},t.buttonClick=function(e,r){i.a.isFunction(r.onClick)?r.onClick(e,r):i.a.isString(r.onClick)&&(o?o.evalExpr(r.onClick,{$event:e,form:r}):t.$eval(r.onClick,{$event:e,form:r}))},t.evalExpr=function(e,r){return o?o.evalExpr(e,r):t.$eval(e,r)},t.evalInScope=function(e,r){if(e)return t.$eval(e,r)},t.interpolate=function(t,r){return t&&e(t)(r)},t.hasSuccess=function(){return!!t.ngModel&&(t.options&&t.options.pristine&&!1===t.options.pristine.success?t.ngModel.$valid&&!t.ngModel.$pristine&&!t.ngModel.$isEmpty(t.ngModel.$modelValue):t.ngModel.$valid&&(!t.ngModel.$pristine||!t.ngModel.$isEmpty(t.ngModel.$modelValue)))},t.hasError=function(){return!!t.ngModel&&(t.options&&t.options.pristine&&!1===t.options.pristine.errors?t.ngModel.$invalid&&!t.ngModel.$pristine:t.ngModel.$invalid)};var s=t.form;t.arrayKey&&(t.$on("schemaForm.error."+t.arrayKey.join("."),function(e,r,n,i){!0!==n&&!1!==n||(i=n,n=void 0),t.ngModel&&r&&(t.ngModel.$setDirty?t.ngModel.$setDirty():(t.ngModel.$dirty=!0,t.ngModel.$pristine=!1),n&&(s.validationMessage||(s.validationMessage={}),s.validationMessage[r]=n),t.ngModel.$setValidity(r,!0===i),!0===i&&(t.ngModel.$validate(),t.$broadcast("schemaFormValidate")))}),t.$on("$destroy",function(){if(!t.externalDestructionInProgress){var e=s.destroyStrategy||t.options&&t.options.destroyStrategy||"remove";if(t.arrayKey&&"retain"!==e){var r=t.model;if(t.arrayKey.length>1&&(r=n.select(t.arrayKey.slice(0,t.arrayKey.length-1),r)),void 0===r)return;var i=t.schema&&t.schema.type||"";"empty"===e&&-1!==i.indexOf("string")?r[t.arrayKey.slice(-1)]="":"empty"===e&&-1!==i.indexOf("object")?r[t.arrayKey.slice(-1)]={}:"empty"===e&&-1!==i.indexOf("array")?r[t.arrayKey.slice(-1)]=[]:"null"===e?r[t.arrayKey.slice(-1)]=null:delete r[t.arrayKey.slice(-1)]}}}))}}}}O.$inject=["$interpolate","$q","sfErrorMessage","sfPath","sfSchema","sfValidators"];var S=O;function j(e,t){return{scope:!1,priority:1001,terminal:!0,compile:function(e,r){return function(e,r,n){var i={};if(""!==n.sfModel?(i=e.$eval(n.sfModel),r.attr("sf-node",i.id)):i=e,i.arrayKey&&i.schema&&(r.attr("ng-model","node.value"),r.attr("schema-validate","node"),!1!==n.sfSetAttributes&&r.is("input, select, textarea")&&(r.attr("name",i.key),r.attr("ng-disabled","evalExpr(form.readonly, { model: model, value: value }) || form.readonly === true"),r.is("input:not([type=checkbox]):not([type=radio])")))){var a=-1!==i.schema.type.indexOf("string"),o=-1!==i.schema.type.indexOf("number"),s=i.form.subType||(!a&&o?"number":"text");r.attr("type",s),i.form.maximum&&r.attr("max",i.form.maximum),i.form.minimum&&r.attr("min",i.form.minimum),i.form.maxlength&&r.attr("maxlength",i.form.maxlength),i.form.minlength&&r.attr("minlength",i.form.minlength),i.form.placeholder&&r.attr("placeholder",i.form.placeholder)}r.removeAttr("sf-model"),t(r)(e)}}}}j.$inject=["sfPath","$compile"];var V=j;function F(e){return{restrict:"E",scope:!0,require:"^sfSchema",link:function(t,r,n,a){var o=t.$eval(n.node);i.a.isObject(o)||(o=a.lookup(n.node));o?e.render(o,null,{},o.path+".items",r,t.$new()):console.warn("Error in sf-render, node is undefined")}}}F.$inject=["sfBuilder"];var k=F;function E(e,t,r,n,a){return{replace:!1,restrict:"A",transclude:!0,require:"?form",scope:{schema:"=sfSchema",initialForm:"=form",model:"=model",options:"=sfOptions"},controller:["$scope","sfPath",function(e,t){e.evalExpr=function(t,r){return e.$parent.$eval(t,r)},this.evalExpr=e.evalExpr,this.lookup=function(r){var n=t.parse(r),a=n.reduce(function(e,t){return i.a.isArray(e)?e[Number(t)]:e&&i.a.isArray(e.items)&&e.items[Number(t)]?e.items[Number(t)]:e&&i.a.isObject(e.properties)?e.properties[t]:void 0},e.tree);return a}}],link:function(o,s,l,c,u){var f,m=["*"],d={},p={};function h(i,c){o.tree=n.compile(c,i,o.model,o.options,d),f&&(o.externalDestructionInProgress=!0,f.$destroy(),o.externalDestructionInProgress=!1),(f=o.$new()).schemaForm={form:o.tree,schema:i},s.children(":not(.schema-form-ignore)").remove();for(var u={},m=s[0].querySelectorAll("*[sf-insert-field]"),p=0;p<m.length;p++)u[m[p].getAttribute("sf-insert-field")]=m[p];f.firstDigest=!0,setTimeout(function(){f.firstDigest=!1},0),r.load().then(function(){var r=e.decorator(l.sfUseDecorator);t.render(o.tree,r,u,void 0,s,f),o.options&&!1===o.options.setSchemaDefaults||a.setDefaults(i,o.model,[],!0),o.$emit("sf-render-finished",s)})}o.formCtrl=c,u(o,function(e){if(e.addClass("schema-form-ignore"),s.prepend(e),s[0].querySelectorAll){var t=s[0].querySelectorAll("[ng-model]");if(t)for(var r=0;r<t.length;r++){var n=t[r].getAttribute("ng-model");d[n.substring(n.indexOf(".")+1)]=!0}}}),o.$watch(function(){var e=o.schema,t=o.initialForm||m;t&&e&&e.type&&(p.form!==t||p.schema!==e)&&Object.keys(e.properties).length>0&&(p.schema=e,p.form=t,h(e,t))}),o.$on("schemaFormRedraw",function(){var e=o.schema,t=o.initialForm?i.a.copy(o.initialForm):m;e&&h(e,t)}),o.$on("$destroy",function(){o.externalDestructionInProgress=!0})}}}E.$inject=["sfDecorators","sfBuilder","sfTemplate","sfForm","sfSchema"];var A=E;function w(){return{require:"ngModel",link:function(e,t,r,n){var a=!1,o=void 0;function s(){n.$formatters.push(function(t){if(i.a.isFunction(o))return o.call(e,t,e,!1);if(i.a.isArray(o)){var r=o.find(function(e){return e.value===t});return r?r.name:t}return i.a.isObject(o)?o[t]:t}),n.$parsers.unshift(function(t){if(i.a.isFunction(o))return o.call(e,t,e,!0);if(i.a.isArray(o)){var r=o.find(function(e){return e.name===t});return r?r.value:t}return i.a.isObject(o)&&i.a.forEach(o,function(e,r){if(i.a.equals(e,t))return r}),t}),n.$processModelValue()}e.$watch(function(){return o=e.$eval(r.sfTransformModel)},function(e,t,r){!e&&e===t||a||(s(),a=!0)})}}}w.$inject=[];var D=w;function P(e,t,r){return{restrict:"A",scope:!1,priority:500,require:"ngModel",link:function(t,n,a,o){var s=null,l=void 0,c=void 0,u=void 0;(l=""!==a.schemaValidate?t.$eval(a.schemaValidate):t).ngModel=o,u=l.schema,l.form.copyValueTo&&o.$viewChangeListeners.push(function(){var e=l.form.copyValueTo;i.a.forEach(e,function(e){r.select(e,t.model,o.$modelValue)})});var f=function(t){if(c=t,!l)return t;if(l.form&&!1===l.form.validation)return t;var r=e.validate(l,t);return Object.keys(o.$error).filter(function(e){return 0===e.indexOf("validator-")}).forEach(function(e){o.$setValidity(e,!0)}),r.valid?t:(o.$setValidity("validator-"+r.error.code,!1),void(s=r.error))};"function"==typeof l.ngModel&&l.ngModel(o),["$parsers","$viewChangeListeners","$formatters"].forEach(function(e){if((l.form[e]||l.schema[e])&&o[e]){var n=function(e){return function(n){if(i.a.isString(n)){var a=n;n=function(e){return t.evalExpr(a,{viewValue:e,ngModel:o,parent:r.select(t.arrayKey.slice(0,-1),t.model)})}}o[e].push(n)}}(e);i.a.forEach(l.form[e],n),i.a.forEach(l.schema[e],n)}}),["$validators","$asyncValidators"].forEach(function(e){if((l.form[e]||l.schema[e])&&o[e]){var n=function(e){return function(n,a){if(i.a.isString(n)){var s=n;n=function(e,n){return t.evalExpr(s,{modelValue:e,viewValue:n,ngModel:o,parent:r.select(t.arrayKey.slice(0,-1),t.model)})}}o[e][a]=n}}(e);i.a.forEach(l.form[e],n),i.a.forEach(l.schema[e],n)}}),o.$parsers.push(f),o.$validators.schemaForm=function(e){return c!==e&&f(e),!Object.keys(o.$error).some(function(e){return"schemaForm"!==e})},t.validateField=function(e){null!=e&&o.$$parentForm.$name!==e||(u&&-1!==u.type.indexOf("array")&&f(o.$modelValue),o.$error={},o.$setDirty(),o.$setViewValue(o.$viewValue),o.$commitViewValue(),f(o.$modelValue),i.a.equals(o.$error,{})&&(o.$$parseAndValidate(),f(o.$modelValue)))},t.validateExternal=function(){if(!t.firstDigest)return t.validateField()},o.$formatters.push(function(e){return!o.$pristine||!t.firstDigest||t.options&&!0===t.options.validateOnRender?(f(o.$modelValue),e):e}),t.$on("schemaFormValidate",function(e,r){t.validateField(r)}),t.$on("schemaFormValidateField",function(e,t,r){l.arrayKey&&l.arrayKey[0]===t&&o.$$parseAndValidate()}),t.schemaError=function(){return s}}}}P.$inject=["sfSchema","$parse","sfPath"];var C=P;i.a.module("schemaForm",["ngSanitize"]).provider("sfPath",p).provider("sfTemplate",y).provider("sfBuilder",o).provider("sfDecorators",l).provider("sfErrorMessage",u).provider("sfValidators",x).provider("sfSchema",v).provider("sfForm",m).directive("sfNode",S).directive("sfRender",k).directive("sfMessage",M).directive("sfModel",V).directive("sfSchema",A).directive("sfTransformModel",D).directive("schemaValidate",C);t.default=i.a.module("schemaForm")},function(e,t,r){r(3),e.exports=r(2)}]);